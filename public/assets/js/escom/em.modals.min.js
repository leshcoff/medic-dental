var EMModal = function() {
    this.el     = "";
    this.modal = null;

    /**
     * Modal filter
     * Dont close te modal
     * @param options
     */
    this.mFilter = function (options, EMGrid) {
        var modal   = null;
        var dom     = options.modal || 'modal-filter';
        var cb      = options.modal || null;
        var msize   = options.msize || "modal-md";
        var title   = options.title || "CRITERIOS DE BUSQUEDA";
        var url     = options.url   ||'/data-table-form';
        var bOk     = true;
        var bCa     = true;

        var $myWindow = $('<div />').appendTo('body');
        $myWindow.attr('id', dom);

        this.el = dom;

        $myWindow.kendoWindow({
            width : (App.isMobile() == true) ? '98%' : options.width  || "800px",
            height: (App.isMobile() == true) ? '95%' : options.height || "90%",
            title: options.title   || "Win",
            visible: false,
            draggable: true,
            modal: true,
            actions: [
                "Maximize",
                "Close"
            ],
            position: {
                top  : (App.isMobile() == true) ? 0 : 25, // or "100px"
                left : (App.isMobile() == true) ? 0 : "25%"
            }
        }).data("kendoWindow").center().open();


        this.modal = $myWindow;



        App.request({
            url     : EMGrid.getURL() + url,
            beforeSend: function(){
                //$this.attr('disabled', 'disabled').html("Loading...");
            },
            success : function (data,  textStatus, xhr) {
                $myWindow.html(data);
            },
            complete: function( jqXHR,  textStatus){

            }
        });

        //set the event datatable on load
        //$(EMGrid.getTable() )
        //.on('xhr.dt', function ( e, settings, json, xhr ) {
        //    btnOK.button('reset');
        //    btnCa.removeAttr('disabled');
            //modal.modal('hide');
        //});

        //btnOK.unbind('click').bind('click',function(){
        //    $(this).data ('loading-text', "<i class='fa fa-circle-o-notch fa-spin'></i> Buscando ...");
        //    $(this).button('loading');
        //    btnCa.attr('disabled', 'disabled');

        //    EMGrid.reload();
        //});

        return  this.modal;
    };

    this.Open = function (options) {
        var w   = $(window).width();
        var dom = options.modal || 'modal-dlg';
        var bOk = true;
        var bCa = true;

        if( options.buttoms ){
            bOk = options.buttoms.ok || true;
            bCa = options.buttoms.cl || true;
        }


        var html = '';
        html  = '<div class="modal fade" id="' + dom + '" role="dialog" aria-labelledby="myModalLabel" aria-hidden="true">';
        html += '  <div class="modal-dialog ' + options.msize + '">';
        html += '    <div class="modal-content">';
        html += '      <div class="modal-header">';
        html += '        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">Ã—</span></button>';
        html += '        <h4 class="modal-title" id="myModalLabel">Modal title</h4>';
        html += '      </div>';
        html += '      <div class="modal-body">';
        html += '        Loading...';
        html += '      </div>';
        html += '      <div class="modal-footer">';
        if (bCa){
            html += '        <button type="button" id="modal-dlg-close" class="btn btn-default" data-dismiss="modal">Cerrar</button>';
        }

        if (bOk){
            html += '        <button type="button" id="modal-dlg-ok"    class="btn btn-primary">Aceptar</button>';
        }
        html += '      </div>';
        html += '    </div>';
        html += '  </div>';
        html += '</div>';

        $('#'+dom).data('bs.modal', null).remove();
        $('body').append(html);
        $('#'+dom+' h4').html(options.title || "Win");

        this.modal = $('#'+dom).modal({ cache:false, keyboard: true, backdrop : options.backdrop || 'static'}).show();


        /*
        $('.modal-content', this.modal).resizable({
            //alsoResize: ".modal-dialog",
            minHeight: 415,
            minWidth: 400,
            alsoResize: ".modal-body, iframe"
        });
        $('.modal-dialog', this.modal).draggable();
        */

        $('#'+dom+' .modal-body').css({overflow:'auto', 'min-height':'300px'});

        $('#'+dom).on('show.bs.modal', function () {
            $(this).find('.modal-body').css({
                'max-height':'100%',
                'max-width':'100%'
            });
        });

        this.modal.on('hidden.bs.modal', function(){
            //fix for stackable windows
            if($('.modal').hasClass('in'))
            {
                $('body').addClass('modal-open');
            }
        });


        //$('body').on('hidden.bs.modal', '.modal', function () {
        //    $(this).removeData('bs.modal');
        //});

        this.load(options);
        return this.modal;

    };

    function onClose(e) {
        $("#undo").fadeIn();
        kendoConsole.log("event :: close");
    }

    this.Close = function(){
        this.modal.data("kendoWindow").close();
    };

    this.Destroy = function(){
        var $this = this;

        var dialog = $this.modal.data("kendoWindow");
        dialog.destroy();
        $this.modal = null;
    }

    this.load = function(options){
        var element = options.modal || 'modal-dlg';
        var modal   = $("#"+element);
        var body    =  this.modal.find('.modal-body');

        //set a new Ajax request
        App.request({
            url      : options.url,
            data     : options.params,
            dataType : "html",
            type     : "POST",
            dataType : "html",
            beforeSend: function(){
                body.html('<div style="height:100%; padding-top:20%; text-align:center;"><span style="font-weight:bold; font-size: 2em;" class="ajax-loading-animation"><span class="btn-loader icofont-spinner"></span></div>');
            },
            success : function (data,  textStatus, xhr) {

                //detecta si es json lo que descarga
                var json = App.decode(data);

                //detecta automaticamente si es un json
                if( json){
                    console.log(json)
                    var jdata = App.handleResponse(xhr.responseText, xhr.status);
                }else {
                    body.css({
                        "opacity": "0.0"
                    }).html(data).delay(10).animate({
                        "opacity": "1.0"
                    }, 50); a = null; b = null;
                }

            },
            complete: function( jqXHR,  textStatus){

            },
            error : function(jqXHR, textStatus,  error) {
                body.html('<h4 class="ajax-loading-error"><i class="fa fa-warning txt-color-orangeDark"></i> Error requesting <span class="txt-color-red">' + textStatus + "</span>: " + jqXHR.status + ' <span style="text-transform: capitalize;">' + error + "</span></h4>")
            }

        });
    };


    /**
     *
     * @param cls
     */
    this.resize = function(width, height){
        var $this = this;
        var dialog = $this.modal.data("kendoWindow");
        dialog.wrapper.width(width);
        dialog.wrapper.height(height);

    }



}
