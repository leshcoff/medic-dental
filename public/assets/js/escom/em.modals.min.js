var EMModal = function() {
    this.el     = "";
    this.modal = null;

    /**
     * Modal filter
     * Dont close te modal
     * @param options
     */
    this.mFilter = function (options, EMGrid) {
        var modal   = null;
        var dom     = options.modal || 'modal-filter';
        var cb      = options.modal || null;
        var msize   = options.msize || "modal-md";
        var title   = options.title || "CRITERIOS DE BUSQUEDA";
        var url     = options.url   ||'/data-table-form';
        var bOk     = true;
        var bCa     = true;

        var $myWindow = $('<div />').appendTo('body');
        $myWindow.attr('id', dom);

        this.el = dom;

        $myWindow.kendoWindow({
            width : (App.isMobile() == true) ? '98%' : options.width  || "800px",
            height: (App.isMobile() == true) ? '95%' : options.height || "90%",
            title: options.title   || "Win",
            visible: false,
            draggable: true,
            modal: true,
            actions: [
                "Maximize",
                "Close"
            ],
            position: {
                top  : (App.isMobile() == true) ? 0 : 25, // or "100px"
                left : (App.isMobile() == true) ? 0 : "25%"
            }
        }).data("kendoWindow").center().open();


        this.modal = $myWindow;



        App.request({
            url     : EMGrid.getURL() + url,
            beforeSend: function(){
                //$this.attr('disabled', 'disabled').html("Loading...");
            },
            success : function (data,  textStatus, xhr) {
                $myWindow.html(data);
            },
            complete: function( jqXHR,  textStatus){

            }
        });

        //set the event datatable on load
        //$(EMGrid.getTable() )
        //.on('xhr.dt', function ( e, settings, json, xhr ) {
        //    btnOK.button('reset');
        //    btnCa.removeAttr('disabled');
            //modal.modal('hide');
        //});

        //btnOK.unbind('click').bind('click',function(){
        //    $(this).data ('loading-text', "<i class='fa fa-circle-o-notch fa-spin'></i> Buscando ...");
        //    $(this).button('loading');
        //    btnCa.attr('disabled', 'disabled');

        //    EMGrid.reload();
        //});

        return  this.modal;
    };

    this.Open = function (options) {
        var $this = this;
        var w   = $(window).width();
        var dom = options.modal || 'modal-dlg';
        var bOk = true;
        var bCa = true;
        var destroyOnClose = options.autoDestroy || false;
        var onClose        = function () { $this.Destroy() }

        if (destroyOnClose  !== true )
        {
            onClose = null;

        }


        var $myWindow = $('<div />').appendTo('body');
        $myWindow.attr('id', dom);

        this.el = dom;

        $myWindow.kendoWindow({
            width : (App.isMobile() == true) ? '98%' : options.width  || "800px",
            height: (App.isMobile() == true) ? '95%' : options.height || "90%",
            title: options.title   || "Win",
            visible: false,
            draggable: true,
            modal: true,
            close:  onClose  ,
            actions: [
                "Maximize",
                "Close"
            ],
            position: {
                top  : (App.isMobile() == true) ? 0 : 25, // or "100px"
                left : (App.isMobile() == true) ? 0 : "25%"
            }
        }).data("kendoWindow").center().open();


        this.modal = $myWindow;
        this.load(options);

        return this.modal;

    };

    function onClose(e) {
        $("#undo").fadeIn();
        kendoConsole.log("event :: close");
    }

    this.Close = function(){
        this.modal.data("kendoWindow").close();
    };

    this.Destroy = function(){
        var $this = this;

        var dialog = $this.modal.data("kendoWindow");
        dialog.destroy();
        $this.modal = null;
    }

    this.load = function(options){
        var element = options.modal || 'modal-dlg';
        var modal   = $("#"+element);
        var body    =  this.modal;


        //set a new Ajax request
        App.request({
            url      : options.url,
            data     : options.params,
            dataType : "html",
            type     : "POST",
            dataType : "html",
            beforeSend: function(){
                body.html('<div style="height:100%; padding-top:20%; text-align:center;"><span style="font-weight:bold; font-size: 2em;" class="ajax-loading-animation"><i class="fa fa-cog fa-spin"></i> Descargando informaci√≥n...</span></div>');
            },
            success : function (data,  textStatus, xhr) {


                //detecta si es json lo que descarga
                var json = App.decode(data);

                //detecta automaticamente si es un json
                if( json){
                    var jdata = App.handleResponse(json, xhr.status);
                }else {
                    body.css({
                        "opacity": "0.0"
                    }).html(data).delay(10).animate({
                        "opacity": "1.0"
                    }, 50); a = null; b = null;
                }



            },
            complete: function( jqXHR,  textStatus){


            },
            error : function(jqXHR, textStatus,  error) {
                var jdata = App.handleResponse(jqXHR.responseText, jqXHR.status);
                //body.html('<h4 class="ajax-loading-error"><i class="fa fa-warning txt-color-orangeDark"></i> Request Error <span class="txt-color-red">' + textStatus + "</span> <br> " + jqXHR.responseText + ' <span style="text-transform: capitalize;">' + error + "</span></h4>")
            }

        });
    };


    /**
     *
     * @param cls
     */
    this.resize = function(width, height){
        var $this = this;
        var dialog = $this.modal.data("kendoWindow");
        dialog.wrapper.width(width);
        dialog.wrapper.height(height);

    }



}
